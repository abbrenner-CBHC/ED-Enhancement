---
title: "CBHC Monthly ED Report"
author: "Allison Brenner"
date: "3/24/2021"
output: 
  html_document:
  theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = TRUE )
```



```{r, include=FALSE}
library(janitor)
library(tidyverse)
library(usethis)
library(yaml)
```

```{r, include=FALSE}
## Import Collective Medical Data from 2020
setwd("~/R/ED Enhancement/raw_data")
ed_2020 <- read_csv("ED_visits_2020.csv") %>% 
    clean_names()
```



```{r,include=FALSE}
# Drop identifiers
ed_2020.hippa <- 
  ed_2020 %>% 
  select(-first_name, -last_name, -date_of_birth)
```

<center>
## **CCBHC-E ED Cascadia Report**
### **February, 2021**

***
<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

<center>
Data from Collective Medical were combined with Cascadia EHR data to determine information on emergency department (ED) utilization in February, 2021. Information presented includes Cascadia clients with an ROI for Collective Medical, who utilized the ED at least once from Feb 1-Feb 28, 2021.  
</div>



### SOME STATS ON PAST 30 DAY ED ENCOUNTERS

#### First, total past month encounters

```{r}
ed_2020.hippa %>% 
  summarise(ed_visit_total = n()) %>% 
  select(ed_visit_total)
  
```
#### Examine encounters by client

```{r}
ed_2020.hippa %>% 
  group_by(member_id) %>% 
  summarise(ed_visit_total = n()) %>% 
  summarise(mean_ed_visits_per_client = mean(ed_visit_total))
```

#### Examine encounters by visit facility

```{r}
ed_2020.hippa %>% 
  count(visit_facility) %>% 
  arrange(desc(n))
```


#### Figure 1 displays the total number of ED visits by month in 2020


```{r}
ed_visits_by_month <- ed_2020_long_2 %>% 
  mutate(month=as.numeric(month)) %>% 
arrange(month) %>% 
group_by(month) %>% 
  add_count(visit)
```

```{r}
ggplot(data=ed_visits_by_month,
        mapping=aes(x=month, y=n)) +
  scale_x_discrete(limits=c("1","2", "3","4","5","6","7","8","9","10","11","12")) +
  scale_y_continuous("ED Visits",limits=c(0,900))+
  geom_col()
```



#### Figure 2 displays the average number of ED visits per month in 2020

```{r}
ggplot(data=ed_visits_by_month,
        mapping=aes(x=month, y=n, group=oregon_ed_disparity_measure)) +
  scale_x_discrete(limits=c("1","2", "3","4","5","6","7","8","9","10","11","12"))
  geom_col()
```

```{r}
ggplot(data=ed_visits_by_month_group,
        mapping=aes(x=month, y=n, group_by(past_year_))) +
  geom_col()
```

